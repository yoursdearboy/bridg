{% extends "standard.html" %}

{% block titlebar_title %}
    {{ _("Persons list") }}
{% endblock %}

{% block content %}

{% with data={ "dateFormat": _("yyyy-MM-dd"), 
               "datetimeFormat": _("yyyy-MM-dd HH:mm:ss"),
               "showURL": url_for(".show", id=":id")} %}
<div x-data='personsTable({{ data | tojson }})'>
    <table class="table" x-ref="table"></table>
</div>
{% endwith %}

{% endblock %}

{% block scripts %}

<script>
function personsTable({ dateFormat, datetimeFormat, showURL }) {
  const columns = [
    { title: "ID", data: "id" },
    {
      title: "Full Name",
      data: "full_primary_name",
    },
    {
      title: "Administrative gender",
      data: "administrative_gender",
    },
    {
      title: "Birth date",
      data: "birth_date",
      render: DataTable.render.datetime(dateFormat),
    },
    {
      title: "Death indicator",
      data: "death_indicator",
      render: function (data) { return data === true ? "Yes" : data === false ? "No" : ""; },
    },
    {
      title: "Death date",
      data: "death_date",
      render: DataTable.render.datetime(dateFormat),
    },
    {
      data: "id",
      sortable: false,
      render: function (data) {
        return "<a href='" + showURL.replace(":id", data) + "' >" +
          "<i class='fa-solid fa-right-to-bracket'></i>" +
        "</a>";
      }
    },
  ];

  return function () {
    var table = this.$refs.table;
    new DataTable(table, {
      ajax: {
        url: ".",
        dataSrc: "",
        beforeSend: function (req) {
          req.setRequestHeader("Content-Type", "application/json")
        }
      },
      columns,
      paging: false,
      searching: false,
    });
  };
}

</script>

{{ super() }}

{% endblock %}
